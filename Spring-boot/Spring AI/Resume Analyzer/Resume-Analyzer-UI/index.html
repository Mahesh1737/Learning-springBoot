<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Analyzer & ATS Checker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 1000px;
            width: 100%;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px;
            text-align: center;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 2px solid #e0e0e0;
        }

        .nav-tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1em;
            color: #666;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .nav-tab:hover {
            background: #ebebeb;
            color: #667eea;
        }

        .nav-tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .upload-section {
            padding: 40px;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 60px 40px;
            background: #f8f9ff;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            text-align: center;
        }

        .upload-area:hover {
            border-color: #764ba2;
            background: #f0f2ff;
            transform: translateY(-2px);
        }

        .upload-area.dragover {
            border-color: #764ba2;
            background: #e8ebff;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4em;
            color: #667eea;
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 1.2em;
            color: #333;
            margin-bottom: 10px;
        }

        .upload-subtext {
            color: #666;
            font-size: 0.9em;
        }

        .file-input {
            display: none;
        }

        .file-info {
            margin-top: 20px;
            padding: 15px;
            background: #e8f5e9;
            border-radius: 10px;
            display: none;
            align-items: center;
            gap: 10px;
        }

        .file-info.show {
            display: flex;
        }

        .file-name {
            flex: 1;
            text-align: left;
            color: #2e7d32;
            font-weight: 500;
        }

        .remove-file {
            background: #f44336;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .remove-file:hover {
            background: #d32f2f;
        }

        .job-description-section {
            margin-top: 30px;
        }

        .job-description-section label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .job-description-textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-family: inherit;
            font-size: 1em;
            resize: vertical;
            transition: border-color 0.3s;
        }

        .job-description-textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .analyze-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 60px;
            font-size: 1.1em;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .analyze-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .analyze-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .loading {
            display: none;
            justify-content: center;
            align-items: center;
            padding: 40px;
            flex-direction: column;
        }

        .loading.show {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 20px;
            color: #667eea;
            font-size: 1.1em;
            font-weight: 500;
        }

        .results {
            display: none;
            padding: 40px;
            animation: fadeIn 0.5s ease;
        }

        .results.show {
            display: block;
        }

        .result-card {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 5px solid #667eea;
        }

        .result-title {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 15px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .result-content {
            color: #555;
            line-height: 1.8;
            white-space: pre-wrap;
        }

        .skill-tag, .keyword-tag {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            margin: 5px;
            font-size: 0.9em;
        }

        .missing-keyword-tag {
            display: inline-block;
            background: #f44336;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            margin: 5px;
            font-size: 0.9em;
        }

        .ats-score-display {
            display: flex;
            align-items: center;
            gap: 30px;
            margin-top: 20px;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.5s ease;
            flex-shrink: 0;
        }

        .score-inner {
            width: 120px;
            height: 120px;
            background: white;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .score-number {
            font-size: 3em;
            font-weight: 700;
            color: #333;
            line-height: 1;
        }

        .score-total {
            font-size: 1em;
            color: #666;
            font-weight: 500;
        }

        .rating-display {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-top: 15px;
        }

        .rating-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.5s ease;
            flex-shrink: 0;
        }

        .rating-inner {
            width: 90px;
            height: 90px;
            background: white;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .rating-number {
            font-size: 2.5em;
            font-weight: 700;
            color: #333;
            line-height: 1;
        }

        .rating-total {
            font-size: 1em;
            color: #666;
            font-weight: 500;
        }

        .score-bar {
            flex: 1;
            height: 35px;
            background: #e0e0e0;
            border-radius: 18px;
            overflow: hidden;
            margin-top: 15px;
        }

        .score-fill {
            height: 100%;
            transition: width 1.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.1em;
        }

        .rating-bar {
            flex: 1;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
        }

        .rating-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 1.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1em;
        }

        .improvement-list {
            list-style: none;
            padding: 0;
        }

        .improvement-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #764ba2;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .new-analysis-btn {
            background: #764ba2;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .new-analysis-btn:hover {
            background: #667eea;
            transform: translateY(-2px);
        }

        .error-message {
            display: none;
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 40px;
            border-left: 4px solid #c62828;
        }

        .error-message.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .summary-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid #667eea;
            line-height: 1.8;
            color: #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Resume Analyzer & ATS Checker</h1>
            <p>AI-Powered Resume Analysis & ATS Compatibility Check</p>
        </div>

        <div class="nav-tabs">
            <div class="nav-tab active" onclick="switchTab('analyzer')">üìä Resume Analyzer</div>
            <div class="nav-tab" onclick="switchTab('ats')">üîç ATS Checker</div>
        </div>

        <!-- Resume Analyzer Tab -->
        <div id="analyzer-tab" class="tab-content active">
            <div class="upload-section" id="analyzerUploadSection">
                <div class="upload-area" id="analyzerUploadArea">
                    <div class="upload-icon">üìÑ</div>
                    <div class="upload-text">Drop your resume here or click to browse</div>
                    <div class="upload-subtext">Supports PDF, DOC, DOCX formats</div>
                </div>
                <input type="file" id="analyzerFileInput" class="file-input" accept=".pdf,.doc,.docx">
                
                <div class="file-info" id="analyzerFileInfo">
                    <span class="file-name" id="analyzerFileName"></span>
                    <button class="remove-file" id="analyzerRemoveFile">Remove</button>
                </div>

                <button class="analyze-btn" id="analyzerBtn" disabled>Analyze Resume</button>
            </div>

            <div class="loading" id="analyzerLoading">
                <div class="spinner"></div>
                <div class="loading-text">Analyzing your resume with AI...</div>
            </div>

            <div class="error-message" id="analyzerError"></div>
            <div class="results" id="analyzerResults"></div>
        </div>

        <!-- ATS Checker Tab -->
        <div id="ats-tab" class="tab-content">
            <div class="upload-section" id="atsUploadSection">
                <div class="upload-area" id="atsUploadArea">
                    <div class="upload-icon">üìÑ</div>
                    <div class="upload-text">Drop your resume here or click to browse</div>
                    <div class="upload-subtext">Supports PDF, DOC, DOCX formats</div>
                </div>
                <input type="file" id="atsFileInput" class="file-input" accept=".pdf,.doc,.docx">
                
                <div class="file-info" id="atsFileInfo">
                    <span class="file-name" id="atsFileName"></span>
                    <button class="remove-file" id="atsRemoveFile">Remove</button>
                </div>

                <div class="job-description-section">
                    <label for="jobDescription">üìù Job Description</label>
                    <textarea 
                        id="jobDescription" 
                        class="job-description-textarea" 
                        placeholder="Paste the job description here...&#10;&#10;Include required skills, qualifications, responsibilities, etc."
                    ></textarea>
                </div>

                <button class="analyze-btn" id="atsBtn" disabled>Check ATS Score</button>
            </div>

            <div class="loading" id="atsLoading">
                <div class="spinner"></div>
                <div class="loading-text">Analyzing ATS compatibility...</div>
            </div>

            <div class="error-message" id="atsError"></div>
            <div class="results" id="atsResults"></div>
        </div>
    </div>

    <script>
        // Tab switching
        function switchTab(tab) {
            const tabs = document.querySelectorAll('.nav-tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(t => t.classList.remove('active'));
            contents.forEach(c => c.classList.remove('active'));
            
            if (tab === 'analyzer') {
                tabs[0].classList.add('active');
                document.getElementById('analyzer-tab').classList.add('active');
            } else {
                tabs[1].classList.add('active');
                document.getElementById('ats-tab').classList.add('active');
            }
        }

        // Resume Analyzer functionality
        const analyzerUploadArea = document.getElementById('analyzerUploadArea');
        const analyzerFileInput = document.getElementById('analyzerFileInput');
        const analyzerFileInfo = document.getElementById('analyzerFileInfo');
        const analyzerFileName = document.getElementById('analyzerFileName');
        const analyzerRemoveFile = document.getElementById('analyzerRemoveFile');
        const analyzerBtn = document.getElementById('analyzerBtn');
        const analyzerUploadSection = document.getElementById('analyzerUploadSection');
        const analyzerLoading = document.getElementById('analyzerLoading');
        const analyzerResults = document.getElementById('analyzerResults');
        const analyzerError = document.getElementById('analyzerError');

        let analyzerSelectedFile = null;

        analyzerUploadArea.addEventListener('click', () => analyzerFileInput.click());
        analyzerUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            analyzerUploadArea.classList.add('dragover');
        });
        analyzerUploadArea.addEventListener('dragleave', () => {
            analyzerUploadArea.classList.remove('dragover');
        });
        analyzerUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            analyzerUploadArea.classList.remove('dragover');
            if (e.dataTransfer.files.length > 0) {
                handleAnalyzerFile(e.dataTransfer.files[0]);
            }
        });

        analyzerFileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleAnalyzerFile(e.target.files[0]);
            }
        });

        analyzerRemoveFile.addEventListener('click', () => {
            analyzerSelectedFile = null;
            analyzerFileInput.value = '';
            analyzerFileInfo.classList.remove('show');
            analyzerBtn.disabled = true;
        });

        function handleAnalyzerFile(file) {
            const validTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
            
            if (validTypes.includes(file.type)) {
                analyzerSelectedFile = file;
                analyzerFileName.textContent = file.name;
                analyzerFileInfo.classList.add('show');
                analyzerBtn.disabled = false;
                hideError(analyzerError);
            } else {
                showError(analyzerError, 'Please upload a valid resume file (PDF, DOC, or DOCX)');
            }
        }

        analyzerBtn.addEventListener('click', async () => {
            if (!analyzerSelectedFile) return;

            analyzerUploadSection.style.display = 'none';
            analyzerLoading.classList.add('show');
            analyzerResults.classList.remove('show');
            hideError(analyzerError);

            const formData = new FormData();
            formData.append('file', analyzerSelectedFile);

            try {
                const response = await fetch('http://localhost:8081/api/resume/analyser', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('Analysis failed. Please try again.');
                }

                const data = await response.json();
                displayAnalyzerResults(data.analysis);
            } catch (error) {
                showError(analyzerError, error.message);
                analyzerUploadSection.style.display = 'block';
            } finally {
                analyzerLoading.classList.remove('show');
            }
        });

        function displayAnalyzerResults(analysis) {
            let parsedData;
            
            try {
                const jsonMatch = analysis.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    parsedData = JSON.parse(jsonMatch[0]);
                } else {
                    parsedData = { rawAnalysis: analysis };
                }
            } catch (e) {
                parsedData = { rawAnalysis: analysis };
            }

            let html = '';

            if (parsedData.skills || parsedData.keySkills || parsedData.key_skills) {
                const skills = parsedData.skills || parsedData.keySkills || parsedData.key_skills;
                html += `
                    <div class="result-card">
                        <div class="result-title">üíº Key Skills Identified</div>
                        <div class="result-content">
                            ${Array.isArray(skills) ? skills.map(skill => {
                                const skillText = typeof skill === 'object' ? (skill.name || skill.skill || JSON.stringify(skill)) : skill;
                                return `<span class="skill-tag">${skillText}</span>`;
                            }).join('') : skills}
                        </div>
                    </div>
                `;
            }

            const ratingFields = ['rating', 'quality', 'overallQuality', 'overall_quality', 'resumeQuality', 'resume_quality', 'score', 'overall_resume_quality'];
            let rating = null;
            
            for (const field of ratingFields) {
                if (parsedData[field] !== undefined) {
                    rating = parsedData[field];
                    break;
                }
            }

            if (rating !== null) {
                let ratingValue = rating;
                
                if (typeof rating === 'string') {
                    const match = rating.match(/(\d+(?:\.\d+)?)/);
                    ratingValue = match ? parseFloat(match[1]) : 0;
                } else if (typeof rating === 'object' && rating.value) {
                    ratingValue = rating.value;
                }
                
                ratingValue = Math.min(Math.max(ratingValue, 0), 10);
                const ratingPercent = ratingValue * 10;
                
                let ratingCategory = '';
                let ratingColor = '';
                if (ratingValue >= 8) {
                    ratingCategory = 'Excellent';
                    ratingColor = '#4caf50';
                } else if (ratingValue >= 6) {
                    ratingCategory = 'Good';
                    ratingColor = '#2196f3';
                } else if (ratingValue >= 4) {
                    ratingCategory = 'Average';
                    ratingColor = '#ff9800';
                } else {
                    ratingCategory = 'Needs Improvement';
                    ratingColor = '#f44336';
                }
                
                html += `
                    <div class="result-card">
                        <div class="result-title">‚≠ê Resume Quality Rating</div>
                        <div class="rating-display">
                            <div class="rating-circle" style="background: conic-gradient(${ratingColor} ${ratingPercent * 3.6}deg, #e0e0e0 0deg);">
                                <div class="rating-inner">
                                    <div class="rating-number">${ratingValue}</div>
                                    <div class="rating-total">/10</div>
                                </div>
                            </div>
                            <div style="flex: 1;">
                                <div style="font-size: 1.3em; font-weight: 600; color: ${ratingColor}; margin-bottom: 10px;">
                                    ${ratingCategory}
                                </div>
                                <div class="rating-bar">
                                    <div class="rating-fill" style="width: ${ratingPercent}%; background: linear-gradient(90deg, ${ratingColor} 0%, ${ratingColor}dd 100%);">
                                        ${ratingValue}/10
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            const improvementFields = ['improvements', 'suggestions', 'recommendations', 'improvement_suggestions'];
            let improvements = null;
            
            for (const field of improvementFields) {
                if (parsedData[field] !== undefined) {
                    improvements = parsedData[field];
                    break;
                }
            }

            if (improvements) {
                html += `
                    <div class="result-card">
                        <div class="result-title">üöÄ Improvement Suggestions</div>
                        <ul class="improvement-list">
                            ${Array.isArray(improvements) ? improvements.map(imp => {
                                let improvementText = '';
                                
                                if (typeof imp === 'string') {
                                    improvementText = imp;
                                } else if (typeof imp === 'object') {
                                    improvementText = imp.suggestion || imp.improvement || imp.text || imp.description || JSON.stringify(imp);
                                }
                                
                                return `<li class="improvement-item">${improvementText}</li>`;
                            }).join('') : `<li class="improvement-item">${improvements}</li>`}
                        </ul>
                    </div>
                `;
            }

            if (!html) {
                html += `
                    <div class="result-card">
                        <div class="result-title">üìä Complete Analysis</div>
                        <div class="result-content">${analysis}</div>
                    </div>
                `;
            }

            html += '<button class="new-analysis-btn" onclick="resetAnalyzer()">Analyze Another Resume</button>';

            analyzerResults.innerHTML = html;
            analyzerResults.classList.add('show');
        }

        function resetAnalyzer() {
            analyzerSelectedFile = null;
            analyzerFileInput.value = '';
            analyzerFileInfo.classList.remove('show');
            analyzerBtn.disabled = true;
            analyzerResults.classList.remove('show');
            analyzerUploadSection.style.display = 'block';
        }

        // ATS Checker functionality
        const atsUploadArea = document.getElementById('atsUploadArea');
        const atsFileInput = document.getElementById('atsFileInput');
        const atsFileInfo = document.getElementById('atsFileInfo');
        const atsFileName = document.getElementById('atsFileName');
        const atsRemoveFile = document.getElementById('atsRemoveFile');
        const jobDescription = document.getElementById('jobDescription');
        const atsBtn = document.getElementById('atsBtn');
        const atsUploadSection = document.getElementById('atsUploadSection');
        const atsLoading = document.getElementById('atsLoading');
        const atsResults = document.getElementById('atsResults');
        const atsError = document.getElementById('atsError');

        let atsSelectedFile = null;

        atsUploadArea.addEventListener('click', () => atsFileInput.click());
        atsUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            atsUploadArea.classList.add('dragover');
        });
        atsUploadArea.addEventListener('dragleave', () => {
            atsUploadArea.classList.remove('dragover');
        });
        atsUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            atsUploadArea.classList.remove('dragover');
            if (e.dataTransfer.files.length > 0) {
                handleATSFile(e.dataTransfer.files[0]);
            }
        });

        atsFileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleATSFile(e.target.files[0]);
            }
        });

        atsRemoveFile.addEventListener('click', () => {
            atsSelectedFile = null;
            atsFileInput.value = '';
            atsFileInfo.classList.remove('show');
            checkATSButtonState();
        });

        jobDescription.addEventListener('input', checkATSButtonState);

        function handleATSFile(file) {
            const validTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
            
            if (validTypes.includes(file.type)) {
                atsSelectedFile = file;
                atsFileName.textContent = file.name;
                atsFileInfo.classList.add('show');
                checkATSButtonState();
                hideError(atsError);
            } else {
                showError(atsError, 'Please upload a valid resume file (PDF, DOC, or DOCX)');
            }
        }

        function checkATSButtonState() {
            atsBtn.disabled = !(atsSelectedFile && jobDescription.value.trim());
        }

        atsBtn.addEventListener('click', async () => {
            if (!atsSelectedFile || !jobDescription.value.trim()) return;

            atsUploadSection.style.display = 'none';
            atsLoading.classList.add('show');
            atsResults.classList.remove('show');
            hideError(atsError);

            const formData = new FormData();
            formData.append('file', atsSelectedFile);
            formData.append('jd', jobDescription.value.trim());

            try {
                const response = await fetch('http://localhost:8081/api/resume/ats-checker', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('ATS check failed. Please try again.');
                }

                const data = await response.json();
                displayATSResults(data['ATS-Report']);
            } catch (error) {
                showError(atsError, error.message);
                atsUploadSection.style.display = 'block';
            } finally {
                atsLoading.classList.remove('show');
            }
        });

        function displayATSResults(report) {
            let parsedData;
            
            try {
                const jsonMatch = report.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    parsedData = JSON.parse(jsonMatch[0]);
                } else {
                    parsedData = { rawReport: report };
                }
            } catch (e) {
                parsedData = { rawReport: report };
            }

            let html = '';

            // ATS Score
            const scoreFields = ['ats-score', 'atsScore', 'ats_score', 'score'];
            let atsScore = null;
            
            for (const field of scoreFields) {
                if (parsedData[field] !== undefined) {
                    atsScore = parsedData[field];
                    break;
                }
            }

            if (atsScore !== null) {
                let scoreValue = atsScore;
                
                if (typeof atsScore === 'string') {
                    const match = atsScore.match(/(\d+(?:\.\d+)?)/);
                    scoreValue = match ? parseFloat(match[1]) : 0;
                } else if (typeof atsScore === 'object' && atsScore.value) {
                    scoreValue = atsScore.value;
                }
                
                scoreValue = Math.min(Math.max(scoreValue, 0), 100);
                
                let scoreCategory = '';
                let scoreColor = '';
                if (scoreValue >= 80) {
                    scoreCategory = 'Excellent Match';
                    scoreColor = '#4caf50';
                } else if (scoreValue >= 60) {
                    scoreCategory = 'Good Match';
                    scoreColor = '#2196f3';
                } else if (scoreValue >= 40) {
                    scoreCategory = 'Fair Match';
                    scoreColor = '#ff9800';
                } else {
                    scoreCategory = 'Poor Match';
                    scoreColor = '#f44336';
                }
                
                html += `
                    <div class="result-card">
                        <div class="result-title">üéØ ATS Compatibility Score</div>
                        <div class="ats-score-display">
                            <div class="score-circle" style="background: conic-gradient(${scoreColor} ${scoreValue * 3.6}deg, #e0e0e0 0deg);">
                                <div class="score-inner">
                                    <div class="score-number">${scoreValue}</div>
                                    <div class="score-total">/100</div>
                                </div>
                            </div>
                            <div style="flex: 1;">
                                <div style="font-size: 1.5em; font-weight: 600; color: ${scoreColor}; margin-bottom: 8px;">
                                    ${scoreCategory}
                                </div>
                                <div style="color: #666; line-height: 1.6; margin-bottom: 15px;">
                                    Your resume has a ${scoreValue}% match with the job description.
                                </div>
                                <div class="score-bar">
                                    <div class="score-fill" style="width: ${scoreValue}%; background: linear-gradient(90deg, ${scoreColor} 0%, ${scoreColor}dd 100%);">
                                        ${scoreValue}%
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Matched Keywords
            const matchFields = ['match keywords', 'matchKeywords', 'match_keywords', 'matched', 'matchedKeywords'];
            let matchedKeywords = null;
            
            for (const field of matchFields) {
                if (parsedData[field] !== undefined) {
                    matchedKeywords = parsedData[field];
                    break;
                }
            }

            if (matchedKeywords && Array.isArray(matchedKeywords) && matchedKeywords.length > 0) {
                html += `
                    <div class="result-card">
                        <div class="result-title">‚úÖ Matched Keywords</div>
                        <div class="result-content">
                            ${matchedKeywords.map(keyword => `<span class="keyword-tag">${keyword}</span>`).join('')}
                        </div>
                    </div>
                `;
            }

            // Missing Keywords
            const missingFields = ['missing keywords', 'missingKeywords', 'missing_keywords', 'missing'];
            let missingKeywords = null;
            
            for (const field of missingFields) {
                if (parsedData[field] !== undefined) {
                    missingKeywords = parsedData[field];
                    break;
                }
            }

            if (missingKeywords && Array.isArray(missingKeywords) && missingKeywords.length > 0) {
                html += `
                    <div class="result-card">
                        <div class="result-title">‚ö†Ô∏è Missing Keywords</div>
                        <div class="result-content">
                            ${missingKeywords.map(keyword => `<span class="missing-keyword-tag">${keyword}</span>`).join('')}
                        </div>
                        <div style="margin-top: 15px; padding: 15px; background: #fff3cd; border-radius: 8px; color: #856404;">
                            <strong>üí° Tip:</strong> Consider adding these keywords to your resume to improve your ATS score and match rate.
                        </div>
                    </div>
                `;
            }

            // Summary
            const summaryFields = ['summary', 'analysis', 'recommendation', 'overview'];
            let summary = null;
            
            for (const field of summaryFields) {
                if (parsedData[field] !== undefined) {
                    summary = parsedData[field];
                    break;
                }
            }

            if (summary) {
                html += `
                    <div class="result-card">
                        <div class="result-title">üìã Analysis Summary</div>
                        <div class="summary-box">
                            ${summary}
                        </div>
                    </div>
                `;
            }

            if (!html) {
                html += `
                    <div class="result-card">
                        <div class="result-title">üìä ATS Report</div>
                        <div class="result-content">${report}</div>
                    </div>
                `;
            }

            html += '<button class="new-analysis-btn" onclick="resetATS()">Check Another Resume</button>';

            atsResults.innerHTML = html;
            atsResults.classList.add('show');
        }

        function resetATS() {
            atsSelectedFile = null;
            atsFileInput.value = '';
            atsFileInfo.classList.remove('show');
            jobDescription.value = '';
            atsBtn.disabled = true;
            atsResults.classList.remove('show');
            atsUploadSection.style.display = 'block';
        }

        function showError(element, message) {
            element.textContent = message;
            element.classList.add('show');
        }

        function hideError(element) {
            element.classList.remove('show');
        }
    </script>
</body>
</html>